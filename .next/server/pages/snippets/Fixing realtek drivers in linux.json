{"pageProps":{"snippet":{"toc":[{"value":"Wifi not functioning after system wakeup from sleep","url":"#wifi-not-functioning-after-system-wakeup-from-sleep","depth":2},{"value":"Bash Script","url":"#bash-script","depth":2}],"mdxSource":"var Component=(()=>{var h=Object.create;var r=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,f=Object.prototype.hasOwnProperty;var g=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports),w=(i,e)=>{for(var t in e)r(i,t,{get:e[t],enumerable:!0})},o=(i,e,t,a)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let s of u(e))!f.call(i,s)&&s!==t&&r(i,s,{get:()=>e[s],enumerable:!(a=p(e,s))||a.enumerable});return i};var b=(i,e,t)=>(t=i!=null?h(m(i)):{},o(e||!i||!i.__esModule?r(t,\"default\",{value:i,enumerable:!0}):t,i)),y=i=>o(r({},\"__esModule\",{value:!0}),i);var l=g((I,c)=>{c.exports=_jsx_runtime});var N={};w(N,{default:()=>x,frontmatter:()=>k});var n=b(l()),k={heading:\"Fixing Realtek drivers in Ubuntu\",title:\"Fixing Realtek drivers in Ubuntu\",date:\"2023-10-06\",type:\"Ubuntu\",draft:!1,summary:\"Wifi drivers not working after going to sleep\",tags:[\"chrome\",\"bash\"]};function d(i){let e=Object.assign({p:\"p\",h2:\"h2\",a:\"a\",span:\"span\",code:\"code\",em:\"em\",pre:\"pre\"},i.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.p,{children:\"Recently I got a new laptop (Legion Pro 5) and installed my favorite Linux distro, Ubuntu, on it. Everything worked like a charm more or less out of the box, even with the Nvidia drivers! One small problem however floored me for a good day until I figured out the root cause.\"}),(0,n.jsxs)(e.h2,{id:\"wifi-not-functioning-after-system-wakeup-from-sleep\",children:[(0,n.jsx)(e.a,{href:\"#wifi-not-functioning-after-system-wakeup-from-sleep\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Wifi not functioning after system wakeup from sleep\"]}),(0,n.jsxs)(e.p,{children:[\"I tried every fix I could find. Restarted network services, tried to manually force the wifi drivers back up, disabled power savings, look in BIOS settings extensively for anything suspicious. Nothing worked. After wasting a couple hours I looked at the output of \",(0,n.jsx)(e.code,{children:\"dmesg\"}),\" and right there I saw the problem. I could see the wifi being up but the driver could not wake up from sleep.\"]}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.em,{children:\"rtw89_8852ce 0000:01:00.0: can't change power state from D3hot to D0 (config space inaccessible)\"})}),(0,n.jsxs)(e.p,{children:[\"After some search engine gymnastics found out \",(0,n.jsx)(e.a,{href:\"https://github.com/lwfinger/rtw88/issues/33\",children:\"a thread\"}),\" very similar to my issue. The only possible explanation is that the BIOS and Realtek drivers cannot communicate properly that the system has woken up from sleep. This explains why the driver works upon a system reboot but not waking up from sleep.\"]}),(0,n.jsx)(e.p,{children:\"The solution is to take down the Realtek wifi drivers before the laptop goes to sleep and bring them back upon resuming.\"}),(0,n.jsxs)(e.h2,{id:\"bash-script\",children:[(0,n.jsx)(e.a,{href:\"#bash-script\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Bash Script\"]}),(0,n.jsxs)(e.p,{children:[\"Make a file in the folder \",(0,n.jsx)(e.code,{children:\"/usr/lib/systemd/system-sleep\"}),\". Put the bash script below in it:\"]}),(0,n.jsx)(e.pre,{children:(0,n.jsxs)(e.code,{className:\"code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`#!/bin/sh\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`case \"$1\" in\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    pre)\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\tmodprobe -r rtw89_8852ce\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\techo \"we are suspending at $(date)...\" > /tmp/systemd_suspend_rtw_driver\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`   \t;;\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    post)\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`        modprobe rtw89_8852ce\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`        ;;\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`esac\n`})]})}),(0,n.jsxs)(e.p,{children:[\"Replace \",(0,n.jsx)(e.code,{children:\"rtw89_8852ce\"}),\" with your own driver if you're using a different one.\"]}),(0,n.jsx)(e.p,{children:\"And there you have it. Hope this helps someone else given the popularity of Legion laptops. I am using Ubuntu 23.04 with 6.2.0-34 kernel.\"})]})}function v(i={}){let{wrapper:e}=i.components||{};return e?(0,n.jsx)(e,Object.assign({},i,{children:(0,n.jsx)(d,i)})):d(i)}var x=v;return y(N);})();\n;return Component;","frontMatter":{"readingTime":{"text":"2 min read","minutes":1.62,"time":97200,"words":324},"slug":"Fixing realtek drivers in linux","fileName":"Fixing realtek drivers in linux.mdx","heading":"Fixing Realtek drivers in Ubuntu","title":"Fixing Realtek drivers in Ubuntu","date":"2023-10-06","type":"Ubuntu","draft":false,"summary":"Wifi drivers not working after going to sleep","tags":["chrome","bash"]}},"commentConfig":{"provider":"giscus","giscusConfig":{"repo":null,"repositoryId":null,"category":null,"categoryId":null,"mapping":"title","reactions":"1","metadata":"0","lightTheme":"light","darkTheme":"transparent_dark","themeURL":""},"utterancesConfig":{"repo":null,"issueTerm":"","label":"","lightTheme":"","darkTheme":""},"disqus":{"shortname":null}}},"__N_SSG":true}